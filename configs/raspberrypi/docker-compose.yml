networks:
  homelab:
    driver: bridge

volumes:
  portainer_data:
  grafana_data:
  uptimekuma_data:

services:

  # ---- 1) Portainer CE ----
  portainer:
    image: portainer/portainer-ce:latest
    restart: unless-stopped
    ports:
      - "9443:9443"
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
      - portainer_data:/data
    networks: [homelab]

  # ---- 2) Paperless-ngx ----
  paperless:
    image: ghcr.io/paperless-ngx/paperless-ngx:latest
    container_name: paperless
    restart: unless-stopped
    depends_on:
      - paperless-redis
    ports:
      - "8000:8000"              # http://<pi-ip>:8000
    environment:
      PAPERLESS_REDIS: redis://paperless-redis:6379
      PAPERLESS_SECRET_KEY: "CHANGE_ME_TO_A_LONG_RANDOM_STRING"
      PAPERLESS_TIME_ZONE: "America/New_York"
      PAPERLESS_OCR_LANGUAGE: "eng"
      # Links in emails, etc.
      PAPERLESS_URL: "http://raspi5:8000"
    volumes:
      # SQLite DB + internal data
      - ./paperless/data:/usr/src/paperless/data
      # Stored documents
      - ./paperless/media:/usr/src/paperless/media
      # Exported backups
      - ./paperless/export:/usr/src/paperless/export
      # "Inbox" â€“ drop PDFs to auto-import
      - ./paperless/consume:/usr/src/paperless/consume

  # Redis for Paperless-ngx
  paperless-redis:
    image: redis:7-alpine
    container_name: homelab-1-paperless-redis
    restart: unless-stopped
    command: ["redis-server", "--save", "60", "1", "--loglevel", "warning"]
    volumes:
      - ./paperless/redis-data:/data

  # ---- 3) Dashy - Touchscreen Home ----
  dashy:
    image: lissy93/dashy:latest
    container_name: homelab-1-dashy
    restart: unless-stopped
    ports:
      - "8080:80"                # http://<pi-ip>:8080
    volumes:
      # Create file: ./dashy/conf.yml
      - ./dashy/conf.yml:/app/public/conf.yml
    environment:
      - NODE_ENV=production

  # ---- 4) Glances - Pi/System Monitor ----
  glances:
    image: nicolargo/glances:latest
    container_name: glances
    restart: unless-stopped
    network_mode: host          # port 61208 of the Pi
    pid: host
    environment:
      - GLANCES_OPT=--webserver
    volumes:
      # Lets Glances show Docker info
      - /var/run/docker.sock:/var/run/docker.sock:ro

  # ---- 5) Prometheus ----
  prometheus:
    image: prom/prometheus:latest
    restart: unless-stopped
    user: "0:0"
    volumes:
      - /opt/homelab/prometheus/config:/etc/prometheus
      - /opt/homelab/prometheus/data:/prometheus
    command:
      - '--config.file=/etc/prometheus/prometheus.yml'
      - '--storage.tsdb.path=/prometheus'
      - '--web.enable-lifecycle'
    ports:
      - "9090:9090"
    networks: [homelab]

  # Node metrics for the Pi itself
  node_exporter:
    image: prom/node-exporter:latest
    restart: unless-stopped
    pid: host
    network_mode: host
    command:
      - '--path.rootfs=/host'
    volumes:
      - '/:/host:ro,rslave'

  # ---- 6) Grafana ----
  grafana:
    image: grafana/grafana:latest
    restart: unless-stopped
    environment:
      - TZ=${TZ}
      - GF_SECURITY_ADMIN_USER=${GF_SECURITY_ADMIN_USER}
      - GF_SECURITY_ADMIN_PASSWORD=${GF_SECURITY_ADMIN_PASSWORD}
      - GF_PATHS_PROVISIONING=/etc/grafana/provisioning
      - GF_AUTH_ANONYMOUS_ENABLED=false
    ports:
      - "3000:3000"
    volumes:
      - grafana_data:/var/lib/grafana
      - /opt/homelab/grafana/provisioning:/etc/grafana/provisioning
    networks: [homelab]

  # ---- 7) Uptime-Kuma ----
  uptime-kuma:
    image: louislam/uptime-kuma:latest
    restart: unless-stopped
    ports:
      - "3001:3001"
    volumes:
      - uptimekuma_data:/app/data
    networks: [homelab]


   # ---- 8) Camera-Stream ----

  mediamtx:
    image: bluenviron/mediamtx:latest-ffmpeg
    devices:
      - /dev/video0:/dev/video0
    ports:
      - "8554:8554" # RTSP
    volumes:
      - '/opt/homelab/mediamtx.yml:/mediamtx.yml:ro'
    restart: unless-stopped
    networks: [homelab]


